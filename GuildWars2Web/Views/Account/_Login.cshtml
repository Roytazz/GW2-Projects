@model GuildWars2Web.Models.LoginViewModel

@{
    bool loggedIn = Convert.ToBoolean(ViewBag.LoggedIn);
    if(loggedIn) {
        <script>
            window.location = "/Character";
        </script>
    }
}

<a href="#" class="dropdown-toggle" data-toggle="dropdown">
    <i class="fa fa-user"></i>
    <span class="hidden-xs">Login</span>
</a>
<ul class="dropdown-menu">
    <li class="user-header user-header-top-menu">
        <div class="login-box-body">
        @using(Ajax.BeginForm("Login", "Account", new AjaxOptions() {
            HttpMethod = "POST",
            InsertionMode = InsertionMode.Replace,
            UpdateTargetId = "login-container"
        })) {
            <div class="form-group has-feedback">
                @Html.TextBoxFor(Model => Model.Username, new { @class = "form-control", placeholder = "Username" })
                <span class="glyphicon glyphicon-user form-control-feedback"></span>
            </div>


            <div class="form-group has-feedback">
                @Html.PasswordFor(Model => Model.Password, new { @class = "form-control", placeholder = "Password (min. 8 character)" })
                <span class="glyphicon glyphicon-lock form-control-feedback"></span>
            </div>
            <div class="error-message">
            @{
                bool error = false;
                if(!loggedIn) {
                    if(Html.ValidationMessage("Username") != null) {
                        error = true;
                    <p>@Html.ValidationMessageFor(Model => Model.Username)</p>
                    }
                    if(Html.ValidationMessage("Password") != null) {
                        error = true;
                    <p>@Html.ValidationMessageFor(Model => Model.Password)</p>
                    }
                }
                if(!error && !loggedIn) {
                    <p>Username/Password is incorrect</p>
                }
            }
            </div>
            <div class="row">
                <div class="col-xs-8">
                    <div class="checkbox icheck checkbox-align-left">
                        <label>
                            @Html.CheckBoxFor(Model => Model.RememberMe) Remember me
                        </label>
                    </div>
                </div>
                <!-- /.col -->
                <div class="col-xs-4 dropdown-top-menu">
                    <button type="submit" class="btn btn-primary btn-block btn-flat">Sign In</button>
                </div>
                <!-- /.col -->
            </div>
        }
        </div>
    </li>
</ul>

<!-- Load iCheck -->
<script>
    $(document).ready(function(){
        $('input').iCheck({
        checkboxClass: 'icheckbox_flat-red'
        });
    });
</script>